!function(t){var i={};function e(s){if(i[s])return i[s].exports;var a=i[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,e),a.l=!0,a.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i);const s={r:0,g:255,b:255},a=(t,i,e)=>({r:i.r*(1-e)+t.r*e,g:i.g*(1-e)+t.g*e,b:i.b*(1-e)+t.b*e}),h={r:255,g:255,b:255};class l{constructor(t,i){this.path=[],this.size_limit=t,this.update_wait=i,this.update_counter=0}pushPoint(t){this.update_counter=(this.update_counter+1)%this.update_wait,0==this.update_counter&&(this.path.push(t),this.path.length>=this.size_limit&&this.path.shift())}pointToCanvas(t,i,e){return{x:(t.x-i.x)*e+800,y:(t.y-i.y)*e+450}}makeColor(t){let i=t/this.size_limit;if(i>.5){let t=1-2*(i-.5);return"rgb("+t*s.r+", "+t*s.g+", "+t*s.b+")"}{let t=a(h,s,1-2*i);return"rgb("+t.r+", "+t.g+", "+t.b+")"}}draw(t,i,e){if(this.path.length<1)return;let s=this.path[0],a=(this.pointToCanvas(s,i,e),0),h=void 0;this.path.forEach(s=>{if(0==a)h=s,a++;else{let l=this.pointToCanvas(s,i,e),o=this.pointToCanvas(h,i,e);t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(l.x,l.y);let n=this.path.length-a;t.strokeStyle=this.makeColor(n),t.closePath(),t.stroke(),h=s,a++}})}}const o=2e3,n=1e3,r=255/o*2;let c=1;class d{constructor(t,i,e){this.id=c++,this.mass=t,this.x=i,this.y=e,this.velocity={x:0,y:0},this.acceleration={x:0,y:0},this.radius=10+3*Math.log(t),this.isColliding=!1,this.time=0,this.path_tracker=new l(600,3)}drawPath(t,i,e,s){this.path_tracker.draw(e,i,s)}draw(t,i,e,s){let a=this.radius*s,h=(this.x-i.x)*s+800,l=(this.y-i.y)*s+450;if(a>.5){if(this.time<o){let t=255,i=0;this.time<n?t=Math.floor(r*this.time):this.time>=n&&(i=Math.floor(r*(this.time-n)));let s="rgb(255, "+t+", "+i+")";e.fillStyle=s}else e.fillStyle="white";e.beginPath(),e.arc(h,l,a,0,2*Math.PI),e.fill()}else e.fillStyle="white",e.fillRect(h,l,1,1)}}class u{constructor(t){this.G=t}exertGravityOnBall(t,i,e){let s={x:0,y:0};i.particles.forEach(t=>{if(t.id!=e.id){let a=t.x-e.x,h=t.y-e.y,l=a*a+h*h,o=this.G*t.mass/l;if(o>.1){let n=Math.sqrt(l);if(n<=e.radius+t.radius)i.collisions.push([e,t]),e.isColliding=!0,t.isColliding=!0;else{let t={x:a/n,y:h/n};s.x+=o*t.x,s.y+=o*t.y}}}}),e.acceleration.x+=s.x,e.acceleration.y+=s.y,e.velocity.x+=s.x*t.seconds,e.velocity.y+=s.y*t.seconds,e.x+=e.velocity.x*t.seconds,e.y+=e.velocity.y*t.seconds,e.path_tracker.pushPoint({x:e.x,y:e.y})}}class y{constructor(t){this.particles=[],this.collisions=[],this.gravity=t}addBallWithVelocity(t,i,e,s,a){let h=new d(t,i,e);h.velocity={x:s,y:a},this.addParticle(h)}addParticle(t){this.particles.push(t)}particles(){return particles}handleCollisions(){this.collisions.forEach(t=>{let i=t[0],e=t[1],s=this.particles.indexOf(i);s>-1&&this.particles.splice(s,1);let a=this.particles.indexOf(e);a>-1&&this.particles.splice(a,1);let h=i.mass+e.mass,l=(i.x*i.mass+e.x*e.mass)/h,o=(i.y*i.mass+e.y*e.mass)/h,n=(i.velocity.x*i.mass+e.velocity.x*e.mass)/h,r=(i.velocity.y*i.mass+e.velocity.y*e.mass)/h,c=new d(h,l,o);c.velocity={x:n,y:r},this.particles.push(c)}),this.collisions=[]}update(t){this.handleCollisions(),this.particles.forEach(i=>{i.time+=t.ms,i.isColliding||this.gravity.exertGravityOnBall(t,this,i)})}}let p=new class{constructor(t,i,e){this.ctx=t,this.width=i,this.height=e,this.ctx.canvas.width=i,this.ctx.canvas.height=e;let s=new u(1e4);this.universe=new y(s),this.wheel=0,this.zoom=1,this.origin={x:0,y:0},this.setInput(),this.isPaused=!1,this.trackPaths=!0}togglePause(){this.isPaused=!this.isPaused}togglePaths(){this.trackPaths=!this.trackPaths}setInput(){this.down=!1,this.ctx.canvas.addEventListener("wheel",t=>{let i=t.wheelDelta/2e3;this.wheel+=i,this.zoom=Math.exp(this.wheel),console.log("zoom: "+this.zoom)}),this.ctx.canvas.addEventListener("mousedown",t=>{this.down=!0}),this.ctx.canvas.addEventListener("mousemove",t=>{this.down&&(this.origin.x-=t.movementX/this.zoom,this.origin.y-=t.movementY/this.zoom)}),this.ctx.canvas.addEventListener("mouseup",t=>{this.down=!1})}init(){var t;(t=this.universe).addBallWithVelocity(1e3,0,0,0,0),t.addBallWithVelocity(1,-400,0,0,50),t.addBallWithVelocity(1,700,0,0,-50),t.addBallWithVelocity(1,0,400,150,0),t.addBallWithVelocity(1,800,800,60,-60)}update(t){this.isPaused||this.universe.update(t)}clear(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.width,this.height)}draw(t){let i=this.origin,e=this.ctx,s=this.zoom;this.universe.particles.forEach(a=>{a.draw(t,i,e,s)}),this.trackPaths&&this.universe.particles.forEach(a=>{a.drawPath(t,i,e,s)})}}(document.getElementById("canvas").getContext("2d"),1600,900);const m={seconds:1/60,ms:1e3/60};p.init();const x=setInterval(function(){try{p.update(m),p.clear(),p.draw(m)}catch(t){console.log(t),clearInterval(x)}},1/60*1e3);document.getElementById("arb").onclick=(()=>{let t=5*Math.random()+.5,i=2*Math.random()*Math.PI,e=600*Math.random()+200,s=e*Math.cos(i),a=e*Math.sin(i),h=800*Math.random()-400,l=800*Math.random()-400;p.universe.addBallWithVelocity(t,s,a,h,l)});let v=document.getElementById("pause");v.onclick=(()=>{p.togglePause(),p.isPaused?v.innerHTML="Continue":v.innerHTML="Pause"}),document.getElementById("track-paths").onclick=(()=>{p.togglePaths()})}]);